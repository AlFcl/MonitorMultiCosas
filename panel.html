<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monitor de Escenario - Panel de Control</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://kit.fontawesome.com/a2c3d66e2b.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="css/panel.css">
</head>
<body>
  <!-- Contenedor de notificaciones -->
  <div id="notifications" class="position-fixed top-0 end-0 p-3" style="z-index: 9999;"></div>

  <div class="container slide-in">
    <!-- Header -->
    <header class="text-center mb-4">
      <h1>
        <i class="fas fa-sliders-h me-2"></i>
        Monitor de Escenario
      </h1>
      <p class="text-muted mb-0">Panel de Control Avanzado</p>
      <div class="mt-2">
        <span class="status-indicator online"></span>
        <small>Sistema Conectado</small>
      </div>
    </header>

    <!-- Botones principales -->
    <section class="content-section">
      <div class="d-flex align-items-center mb-3">
        <i class="fas fa-tv me-2 text-primary"></i>
        <h5 class="mb-0">Control de Visualización</h5>
      </div>
      
      <div class="btn-group-main">
        <button class="btn btn-primary btn-pulse" onclick="mostrar('iframe')">
          <i class="fas fa-globe me-2"></i>
          Contenido
        </button>
        <button class="btn btn-success btn-pulse" onclick="mostrar('timer')">
          <i class="fas fa-hourglass-half me-2"></i>
          Temporizador
        </button>
        <button class="btn btn-warning btn-pulse" onclick="mostrar('mensaje')">
          <i class="fas fa-bullhorn me-2"></i>
          Mensaje
        </button>
      </div>

      <div class="mt-3">
        <button class="btn btn-outline-light" onclick="abrirPantalla()">
          <i class="fas fa-external-link-alt me-2"></i>
          Abrir Pantalla de Escenario
        </button>
      </div>
    </section>

    <!-- Configuración de contenido -->
    <section class="content-section">
      <div class="d-flex align-items-center mb-3">
        <i class="fas fa-link me-2 text-primary"></i>
        <h5 class="mb-0">Configuración de Contenido</h5>
      </div>
      
      <div class="mb-3">
        <label for="url" class="form-label">
          <i class="fas fa-globe me-2"></i>
          URL del contenido web
        </label>
        <input type="url" id="url" class="form-control" 
               value="https://ictuesantacruz.cl" 
               placeholder="https://ejemplo.com"
               aria-describedby="urlHelp">
        <div id="urlHelp" class="form-text text-muted">
          Introduce la URL que se mostrará en el escenario
        </div>
      </div>
    </section>

    <!-- Control del temporizador -->
    <section class="timer-controls">
      <div class="d-flex align-items-center mb-3">
        <i class="fas fa-clock me-2 text-success"></i>
        <h5 class="mb-0">Control del Temporizador</h5>
      </div>

      <div class="timer-inputs">
        <div class="timer-input-group">
          <label for="horas">Horas</label>
          <input type="number" id="horas" class="form-control" 
                 min="0" max="23" value="0" 
                 aria-label="Horas">
        </div>
        <div class="timer-input-group">
          <label for="minutos">Minutos</label>
          <input type="number" id="minutos" class="form-control" 
                 min="0" max="59" value="5" 
                 aria-label="Minutos">
        </div>
        <div class="timer-input-group">
          <label for="segundos">Segundos</label>
          <input type="number" id="segundos" class="form-control" 
                 min="0" max="59" value="0" 
                 aria-label="Segundos">
        </div>
      </div>

      <div class="timer-buttons">
        <button class="btn btn-info" onclick="actualizarTiempo()" title="Actualizar tiempo (U)">
          <i class="fas fa-sync-alt me-2"></i>
          Actualizar Tiempo
        </button>
        <button class="btn btn-success" onclick="enviarComando('start')" title="Iniciar temporizador (Espacio)">
          <i class="fas fa-play me-2"></i>
          Iniciar
        </button>
        <button class="btn btn-warning" onclick="enviarComando('pause')" title="Pausar temporizador">
          <i class="fas fa-pause me-2"></i>
          Pausar
        </button>
        <button class="btn btn-danger" onclick="enviarComando('reset')" title="Reiniciar temporizador (Shift+R)">
          <i class="fas fa-undo me-2"></i>
          Reiniciar
        </button>
      </div>

      <!-- Presets de tiempo rápidos -->
      <div class="mt-3">
        <h6 class="text-muted mb-2">
          <i class="fas fa-magic me-2"></i>
          Tiempos Rápidos
        </h6>
        <div class="d-flex gap-2 flex-wrap">
          <button class="btn btn-sm btn-outline-light" onclick="setTiempoRapido(0, 1, 0)">
            1 min
          </button>
          <button class="btn btn-sm btn-outline-light" onclick="setTiempoRapido(0, 5, 0)">
            5 min
          </button>
          <button class="btn btn-sm btn-outline-light" onclick="setTiempoRapido(0, 10, 0)">
            10 min
          </button>
          <button class="btn btn-sm btn-outline-light" onclick="setTiempoRapido(0, 15, 0)">
            15 min
          </button>
          <button class="btn btn-sm btn-outline-light" onclick="setTiempoRapido(0, 30, 0)">
            30 min
          </button>
          <button class="btn btn-sm btn-outline-light" onclick="setTiempoRapido(0, 40, 0)">
            40 min
          </button>
          <button class="btn btn-sm btn-outline-light" onclick="setTiempoRapido(1, 0, 0)">
            1 hora
          </button>
        </div>
      </div>
    </section>

    <!-- Configuración de mensajes -->
    <section class="message-section">
      <div class="d-flex align-items-center mb-3">
        <i class="fas fa-comment-alt me-2 text-warning"></i>
        <h5 class="mb-0">Mensajes al Escenario</h5>
      </div>
      
      <div class="mb-3">
        <label for="mensaje" class="form-label">
          <i class="fas fa-edit me-2"></i>
          Mensaje personalizado
        </label>
        <div class="input-group">
          <input type="text" id="mensaje" class="form-control" 
                 placeholder="Escribe un mensaje para mostrar en pantalla"
                 maxlength="200"
                 aria-describedby="mensajeHelp">
          <button class="btn btn-warning" onclick="mostrar('mensaje')">
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>
        <div id="mensajeHelp" class="form-text text-muted">
          Máximo 200 caracteres
        </div>
      </div>

      <!-- Mensajes predefinidos -->
      <div class="mt-3">
        <h6 class="text-muted mb-2">
          <i class="fas fa-list me-2"></i>
          Mensajes Rápidos
        </h6>
        <div class="d-flex gap-2 flex-wrap">
          <button class="btn btn-sm btn-outline-warning" onclick="setMensajeRapido('¡Bienvenidos!')">
            Bienvenida
          </button>
          <button class="btn btn-sm btn-outline-warning" onclick="setMensajeRapido('Pausa de 15 minutos')">
            Pausa
          </button>
          <button class="btn btn-sm btn-outline-warning" onclick="setMensajeRapido('Próximamente...')">
            Próximamente
          </button>
          <button class="btn btn-sm btn-outline-warning" onclick="setMensajeRapido('¡Gracias por participar!')">
            Despedida
          </button>
        </div>
      </div>
    </section>

    <!-- Panel de estado -->
    <section class="content-section">
      <div class="d-flex align-items-center mb-3">
        <i class="fas fa-info-circle me-2 text-info"></i>
        <h5 class="mb-0">Estado del Sistema</h5>
      </div>
      
      <div class="connection-status">
        <span class="status-indicator online"></span>
        <small class="text-success">Sistema Conectado y Funcionando</small>
      </div>
      
      <div class="row g-3">
        <div class="col-md-4">
          <div class="card status-card">
            <div class="card-body text-center">
              <i class="fas fa-eye fa-2x text-primary"></i>
              <h6>Vista Actual</h6>
              <span id="estado-vista" class="status-badge badge-vista-contenido">Contenido Web</span>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card status-card">
            <div class="card-body text-center">
              <i class="fas fa-stopwatch fa-2x text-success"></i>
              <h6>Temporizador</h6>
              <span id="estado-timer" class="status-badge badge-timer-inactivo">Inactivo</span>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card status-card">
            <div class="card-body text-center">
              <i class="fas fa-info fa-2x text-warning"></i>
              <h6>Contenido Actual</h6>
              <div id="contenido-actual" class="contenido-info fade-transition">
                <div id="url-actual" class="url-display">
                  <strong>URL Activa:</strong>
                  <small>https://ictuesantacruz.cl</small>
                </div>
                <div id="mensaje-actual" class="mensaje-display" style="display: none;">
                  <strong>Mensaje:</strong>
                  <small></small>
                </div>
                <div id="tiempo-restante" class="tiempo-display" style="display: none;">
                  <strong>Tiempo:</strong>
                  <small></small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Ayuda de atajos de teclado -->
    <div class="alert alert-dark">
      <h6>
        <i class="fas fa-keyboard me-2"></i>
        Atajos de Teclado
      </h6>
      <div class="row">
        <div class="col-md-6">
          <small>
            <strong>Ctrl+1:</strong> Mostrar Contenido<br>
            <strong>Ctrl+2:</strong> Mostrar Timer<br>
            <strong>Ctrl+3:</strong> Mostrar Mensaje
          </small>
        </div>
        <div class="col-md-6">
          <small>
            <strong>Espacio:</strong> Iniciar Timer<br>
            <strong>Shift+R:</strong> Reiniciar Timer<br>
            <strong>U:</strong> Actualizar Tiempo
          </small>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <img src="assets/logo.svg" alt="Logo" width="120" class="mb-3">
    <p class="text-light mb-0">
      © Creado por <strong>alf.cl</strong> - 2025
    </p>
    <p class="text-muted small">
      Monitor de Escenario v2.0 - Panel de Control Avanzado
    </p>
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/panel.js"></script>
  
  <script>
    // Funciones adicionales para los botones rápidos
    function setTiempoRapido(horas, minutos, segundos) {
      document.getElementById('horas').value = horas;
      document.getElementById('minutos').value = minutos;
      document.getElementById('segundos').value = segundos;
      actualizarTiempo();
    }

    function setMensajeRapido(mensaje) {
      document.getElementById('mensaje').value = mensaje;
      mostrar('mensaje');
    }

    // Indicador de caracteres restantes
    document.getElementById('mensaje').addEventListener('input', function(e) {
      const maxLength = 200;
      const currentLength = e.target.value.length;
      const remaining = maxLength - currentLength;
      
      const helpText = document.getElementById('mensajeHelp');
      helpText.textContent = `${remaining} caracteres restantes`;
      
      if (remaining < 20) {
        helpText.className = 'form-text text-warning';
      } else {
        helpText.className = 'form-text text-muted';
      }
    });

    // Auto-save al cambiar valores
    ['url', 'mensaje', 'horas', 'minutos', 'segundos'].forEach(id => {
      const element = document.getElementById(id);
      if (element) {
        element.addEventListener('change', () => {
          console.log(`Guardando ${id}: ${element.value}`);
          
          // Actualizar contenido actual si es URL
          if (id === 'url' && panelControl) {
            panelControl.actualizarEstadoContenido('contenido', element.value);
          }
        });
        
        // También actualizar en tiempo real al escribir
        element.addEventListener('input', () => {
          if (id === 'url' && panelControl) {
            panelControl.actualizarEstadoContenido('contenido', element.value);
          }
        });
      }
    });

    // Actualizar tiempo restante en tiempo real
    function actualizarTiempoEnPantalla() {
      const horas = parseInt(document.getElementById('horas').value) || 0;
      const minutos = parseInt(document.getElementById('minutos').value) || 0;
      const segundos = parseInt(document.getElementById('segundos').value) || 0;
      
      const totalSegundos = horas * 3600 + minutos * 60 + segundos;
      
      if (totalSegundos > 0 && panelControl) {
        let tiempoFormateado;
        if (horas > 0) {
          tiempoFormateado = `${horas}:${minutos.toString().padStart(2, '0')}:${segundos.toString().padStart(2, '0')}`;
        } else {
          tiempoFormateado = `${minutos}:${segundos.toString().padStart(2, '0')}`;
        }
        panelControl.actualizarEstadoContenido('temporizador', `Configurado: ${tiempoFormateado}`);
        panelControl.actualizarBadgeTimer('configurado');
      } else if (panelControl) {
        panelControl.actualizarEstadoContenido('temporizador', 'No configurado');
        panelControl.actualizarBadgeTimer('inactivo');
      }
    }

    // Actualizar cuando cambien los inputs de tiempo
    ['horas', 'minutos', 'segundos'].forEach(id => {
      const element = document.getElementById(id);
      element.addEventListener('input', actualizarTiempoEnPantalla);
      element.addEventListener('change', actualizarTiempoEnPantalla);
    });

    // Actualizar mensaje en tiempo real
    document.getElementById('mensaje').addEventListener('input', function(e) {
      if (panelControl && e.target.value.trim()) {
        panelControl.actualizarEstadoContenido('mensaje', e.target.value.trim());
      }
    });

    // Función para simular pulsación de tecla para testing
    window.simularCambioEstado = function(tipo, valor) {
      if (panelControl) {
        switch(tipo) {
          case 'vista':
            panelControl.actualizarBadgeVista(valor);
            break;
          case 'timer':
            panelControl.actualizarBadgeTimer(valor);
            break;
          case 'contenido':
            panelControl.actualizarEstadoContenido('contenido', valor);
            break;
        }
      }
    };

    // Inicializar el tiempo mostrado
    setTimeout(() => {
      actualizarTiempoEnPantalla();
    }, 100);empoDiv = document.getElementById('tiempo-restante');
      
      if (totalSegundos > 0) {
        let tiempoFormateado;
        if (horas > 0) {
          tiempoFormateado = `${horas}:${minutos.toString().padStart(2, '0')}:${segundos.toString().padStart(2, '0')}`;
        } else {
          tiempoFormateado = `${minutos}:${segundos.toString().padStart(2, '0')}`;
        }
        tiempoDiv.innerHTML = `<strong>Tiempo configurado:</strong><br><small>${tiempoFormateado}</small>`;
      }
    }

    // Actualizar cuando cambien los inputs de tiempo
    ['horas', 'minutos', 'segundos'].forEach(id => {
      document.getElementById(id).addEventListener('input', actualizarTiempoEnPantalla);
    });

    // Inicializar el tiempo mostrado
    actualizarTiempoEnPantalla();
  </script>
</body>
</html>